# AniLibria API – v2.13.1

> :warning: **Внимание**: 
> 
> **После выхода версии v2.13.0 поддержка всех предыдущих версий API до v2.12.0 была прекращена!**
>
>В связи с переходом на новый бэкэнд сайта с существенными изменениями в архитектуре проекта. 
>
>    Из основных изменений - новая структура объекта poster, который теперь стал posters, и содержит теперь не 1 а 3 постера в разном качестве, с ссылками которые меняются сами при изменении постера, так что перерь не нужно исполдьзовать время последего изменения, а так-же поменялись пути в ссылках на торренты и потоковое вещание.


- [**RestAPI**](#-restapi) – *Документация по RestAPI*
- [**WebSocket**](#-websocket) – *Документация по WebSocket*

## Rest API
```
http(s)://api.anilibria.tv/v2/
```

# Список методов:

## Открытые методы
- [**getTitle**](#-gettitle) – *Получить информацию о тайтле*
- [**getTitles**](#-gettitles) – *Получить информацию о нескольких тайтлах сразу*
- [**getUpdates**](#-getupdates) – *Список тайтлов отсортированный по времени добавления нового релиза*
- [**getChanges**](#-getchanges) – *Список тайтлов отсортированный по времени изменения*
- [**getSchedule**](#-getschedule) – *Расписание выхода тайтлов, отсортированное по дням недели*
- [**getRandomTitle**](#-getrandomtitle) – *Возвращает случайный тайтл из базы*
- [**getYouTube**](#-getyoutube) – *Информация о вышедших роликах на наших YouTube каналах в хронологическом порядке*
- [**getFeed**](#-getfeed) – *Список обновлений тайтлов и роликов на наших YouTube каналах в хронологическом порядке*
- [**getYears**](#-getyears) – *Возвращает список годов выхода доступных тайтлов по возрастанию*
- [**getGenres**](#-getgenres) – *Возвращает список жанров доступных тайтлов по алфавиту*
- [**getCachingNodes**](#-getcachingnodes) – *Список кеш серверов с которых можно брать данные*
- [**getTeam**](#-getteam) – *Возвращает список участников команды когда-либо существовавших на проекте.*
- [**getSeedStats**](#-getseedstats) – *Возвращает список пользователей и их статистику на трекере.*
- [**getRSS**](#-getrss) – *Возвращает список обновлений на сайте в одном из форматов RSS ленты*
- [**searchTitles**](#-searchtitles) – *Возвращает список найденных по фильтрам тайтлов*
- [**advancedSearch**](#-advancedsearch) – *Поиск информации по продвинутым фильтрам с поддержкой сортировки*

## Пользовательские методы требующие авторизации
- [**getFavorites**](#-getfavorites) – *Получить список избранных тайтлов пользователя*
- [**addFavorite**](#-addfavorite) – *Добавить тайтл в список избранных*
- [**delFavorite**](#-delfavorite) – *Удалить тайтл из списка избранных*

# Описание методов: 

## • getTitle
Получить информацию о тайтле по id или коду 
```js
GET /v2/getTitle
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
id | int | ID тайтла |
code | string | Код тайтла |
torrent_id | int | ID торрент файла |
filter | string, ... | Список значений которые будут в ответе |
remove | string, ... | Список значений которые будут удалены из ответа |
[include](#include) | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
[description_type](#description_type) | string | Тип получаемого описания, [подробнее](#description_type) | plain
playlist_type | string | Формат получаемого списка серий, `object` или `array` | object

*В параметрах `filter` и `remove` можно указать полный путь до ключа который вы хотите оставить или удалить, например `names.alternative` или `team.voice[0]`, с версии 2.8. появилась возможность получать значения одного ключа во всех объектах в массиве, например: torrents.list[\*].torrent_id*



### Примеры запросов
```js
/v2/getTitle?id=8500&filter=posters,type,status,player.playlist.24
```
```js
/v2/getTitle?code=nanatsu-no-taizai-kamigami-no-gekirin
```

### Пример ответа
```json
{
    "id": 8500,
    "code": "nanatsu-no-taizai-kamigami-no-gekirin",
    "names": {
        "ru": "Семь смертных грехов: Гнев богов ТВ-3",
        "en": "Nanatsu no Taizai: Kamigami no Gekirin TV-3",
        "alternative": null
    },
    "announce": "В 24 серии замена войсера. В течение недели будет исправление.",
    "status": {
        "string": "Завершен",
        "code": 2
    },
    "posters": {
        "small": {
            "url": "/media/releases/posters/8500/upFsMkr3ZkMtBQEC.jpg",
            "raw_base64_file": null
        },
        "medium": {
            "url": "/media/releases/posters/8500/4Qv6yx0Mr3Kxpu6B.jpg",
            "raw_base64_file": null
        },
        "original": {
            "url": "/media/releases/posters/8500/W4Q1mG49XVQnOUnc.jpg",
            "raw_base64_file": null
        }
    },
    "updated": 1585249972,
    "last_change": 1642539074,
    "type": {
        "full_string": "TV (24 эп.), 25 мин.",
        "code": 1,
        "string": "TV",
        "series": 24,
        "length": "25 мин"
    },
    "genres": [
        "Магия",
        "Приключения",
        "Сверхъестественное",
        "Сёнен",
        "Экшен"
    ],
    "team": {
        "voice": [
            "Anzen",
            "Cleo-chan",
            "Hekomi",
            "Kari",
            "Sharon"
        ],
        "translator": [
            "Anku"
        ],
        "editing": [
            "mutagenb"
        ],
        "decor": [
            
        ],
        "timing": [
            "Alkhorus"
        ]
    },
    "season": {
        "string": "осень",
        "code": 4,
        "year": 2019,
        "week_day": 5
    },
    "description": "Продолжение аниме «Семь смертных грехов» расскажет нам о том, как Грехи продолжают противостояние с Десятью Заповедями. Мелиодасу и Элизабет предстоит вновь испытать свою судьбу в новых приключениях и сражениях, а также открыть секрет этого мира.",
    "in_favorites": 10134,
    "blocked": {
        "blocked": false,
        "bakanim": false
    },
    "player": {
        "alternative_player": "//kodik.info/serial/19248/803944eb832adacd4d4bec7d4221f941/720p?translations=false",
        "host": "de6.libria.fun",
        "series": {
            "first": 1,
            "last": 24,
            "string": "1-24"
        },
        "playlist": {
            "1": {
                "serie": 1,
                "created_timestamp": 1570809272,
                "hls": {
                    "fhd": "/videos/media/ts/8500/1/1080/6a6fc29f9428b2dcc8ce74ad21bb1cca.m3u8",
                    "hd": "/videos/media/ts/8500/1/720/8e5d9ba9e79d80ca6b6db6e6e375b4bb.m3u8",
                    "sd": "/videos/media/ts/8500/1/480/93048587fb765c9f2077ca7adad9457e.m3u8"
                }
            },
            ...
        }
    },
    "torrents": {
        "series": {
            "first": 1,
            "last": 24,
            "string": "1-24"
        },
        "list": [
            {
                "torrent_id": 10725,
                "series": {
                    "first": 1,
                    "last": 24,
                    "string": "1-24"
                },
                "quality": {
                    "string": "WEBRip 1080p",
                    "type": "WEBRip",
                    "resolution": 1080,
                    "encoder": "h264",
                    "lq_audio": false
                },
                "leechers": 0,
                "seeders": 0,
                "downloads": 10070,
                "total_size": 35521275317,
                "url": "/public/torrent/download.php?id=10725",
                "uploaded_timestamp": 1590483840,
                "metadata": null,
                "raw_base64_file": null
            },
			...
        ]
    }
}
```
***

## • getTitles
Получить информацию о тайтле по id или коду 
```js
GET /v2/getTitles
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
id_list | string, ... | Список ID тайтлов |
code_list | string, ... | Список кодов тайтла |
filter | string, ... | Список значений которые будут в ответе |
remove | string, ... | Список значений которые будут удалены из ответа |
[include](#include) | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
[description_type](#description_type) | string | Тип получаемого описания, [подробнее](#description_type) | plain
playlist_type | string | Формат получаемого списка серий, `object` или `array` | object

*В параметрах `filter` и `remove` можно указать полный путь до ключа который вы хотите оставить или удалить, например `names.alternative` или `team.voice[0]`, с версии 2.8. появилась возможность получать значения одного ключа во всех объектах в массиве, например: torrents.list[\*].torrent_id*



### Примеры запросов
```js
/v2/getTitles?id_list=8500,8644&filter=posters,type,status,player.playlist.24
```
```js
/v2/getTitles?code_list=nanatsu-no-taizai-kamigami-no-gekirin
```

### Пример ответа
```json
[
	[Возвращаемые поля идентичны /getTitle],
	...
]
```
***


## • getUpdates
Получить список последних обновлений тайтлов

```js
GET /v2/getUpdates
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
filter | string, ... | Список значений которые будут в ответе | 
remove | string, ... | Список значений которые будут удалены из ответа | 
[include](#include) | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
[limit](#limit) | int | Количество объектов в ответе | 5
since | int | Список тайтлов у которых время обновления больше указанного timestamp | 
[description_type](#description_type) | string | Тип получаемого описания, [подробнее](#description_type) | plain
playlist_type | string | Формат получаемого списка серий, `object` или `array` | object
after | int | Удаляет первые n записей из выдачи  | 

*В параметрах `filter` и `remove` можно указать полный путь до ключа который вы хотите оставить или удалить, например `names.alternative` или `team.voice[0]`, с версии 2.8. появилась возможность получать значения одного ключа во всех объектах в массиве, например: torrents.list[\*].torrent_id*

### Примеры запросов
```js
/api/v2/getUpdates?filter=posters,type,status&limit=5
```
```js
/api/v2/getUpdates?since=1590233417
```
### Пример ответа

```json
[
	[Возвращаемые поля идентичны /getTitle],
	...
]
```
***

## • getChanges
Получить список последних обновлений тайтлов

```js
GET /v2/getChanges
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
filter | string, ... | Список значений которые будут в ответе | 
remove | string, ... | Список значений которые будут удалены из ответа | 
[include](#include) | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
[limit](#limit) | int | Количество объектов в ответе | 5
since | int | Список тайтлов у которых время обновления больше указанного timestamp | 
[description_type](#description_type) | string | Тип получаемого описания, [подробнее](#description_type) | plain
after | int | Удаляет первые n записей из выдачи  | 

*В параметрах `filter` и `remove` можно указать полный путь до ключа который вы хотите оставить или удалить, например `names.alternative` или `team.voice[0]`, с версии 2.8. появилась возможность получать значения одного ключа во всех объектах в массиве, например: torrents.list[\*].torrent_id*

### Примеры запросов
```js
/v2/getChanges?filter=posters,type,status&limit=5
```
```js
/v2/getChanges?since=1590233417
```
### Пример ответа

```json
[
	[Возвращаемые поля идентичны /getTitle],
	...
]
```
***


## • getSchedule
Получить список последних обновлений тайтлов

```js
GET /v2/getSchedule
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | --  | -- 
filter | string, ... | Список значений которые будут в ответе
remove | string, ... | Список значений которые будут удалены из ответа
[include](#include) | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
days | string, ...  | Список дней недели на которые нужно расписание
[description_type](#description_type) | string | Тип получаемого описания, [подробнее](#description_type) | plain
playlist_type | string | Формат получаемого списка серий, `object` или `array` | object

*В параметрах `filter` и `remove` можно указать полный путь до ключа который вы хотите оставить или удалить, например `names.alternative` или `team.voice[0]`, с версии 2.8. появилась возможность получать значения одного ключа во всех объектах в массиве, например: torrents.list[\*].torrent_id*

> Счет дней недели идет с понедельника, где 0 - Понедельник, а 6 - Воскресенье.

### Примеры запросов
```js
/v2/getSchedule?filter=posters,type,status
```
```js
/v2/getSchedule?days=5,6
```
### Пример ответа

```json
[
	{
		"day": 5,
		"list": [
			[Возвращаемые поля идентичны /getTitle],
			...
		]
	},{
		"day": 6,
		"list": [
			[Возвращаемые поля идентичны /getTitle],
			...
		]
	}
]
```
***


## • getCachingNodes
Список кеш серверов с которых можно брать данные отсортированные по нагрузке
Севера сортируются в реальном времени, по этому рекомендуется для каждого сервера использовать один из самых верхних серверов.

```js
GET /v2/getCachingNodes
```

### Примеры запросов
```js
/v2/getCachingNodes
```
### Пример ответа

```json
[
	"de3.libria.fun",
	"de2.libria.fun",
	"de8.libria.fun",
	"de1.libria.fun",
	"de6.libria.fun"
]
```
***


## • getRandomTitle
Возвращает случайный тайтл из базы

```js
GET /v2/getRandomTitle
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | --  | -- 
filter | string, ... | Список значений которые будут в ответе
remove | string, ... | Список значений которые будут удалены из ответа
[include](#include) | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
[description_type](#description_type) | string | Тип получаемого описания, [подробнее](#description_type) | plain
playlist_type | string | Формат получаемого списка серий, `object` или `array` | object

*В параметрах `filter` и `remove` можно указать полный путь до ключа который вы хотите оставить или удалить, например `names.alternative` или `team.voice[0]`, с версии 2.8. появилась возможность получать значения одного ключа во всех объектах в массиве, например: torrents.list[\*].torrent_id*

### Примеры запросов
```js
/v2/getRandomTitle
```
### Пример ответа

```json
{
    [Возвращаемые поля идентичны /getTitle],
}
```
***


## • getYouTube
Информация о вышедших роликах на наших YouTube каналах в хронологическом порядке

```js
GET /v2/getYouTube
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
filter | string, ... | Список значений которые будут в ответе | 
remove | string, ... | Список значений которые будут удалены из ответа | 
[limit](#limit) | int | Количество объектов в ответе | 5
since | int | Список видеороликов у которых время обновления больше указанного timestamp | 
after | int | Удаляет первые n записей из выдачи  | 

*В параметрах `filter` и `remove` можно указать полный путь до ключа который вы хотите оставить или удалить, например `names.alternative` или `team.voice[0]`, с версии 2.8. появилась возможность получать значения одного ключа во всех объектах в массиве, например: torrents.list[\*].torrent_id*

### Примеры запросов
```js
/v2/getYouTube?limit=10
```
### Пример ответа

```json
[
    {
        "id": 341,
        "title": "АНОНС - АНИМЕ ЗИМА 2017",
        "image": "https://img.youtube.com/vi/OXBO4h3l3rM/0.jpg",
        "youtube_id": "OXBO4h3l3rM",
        "timestamp": 1503824801
    },
	...
}
```
***


## • getFeed
Список обновлений тайтлов и роликов на наших YouTube каналах в хронологическом порядке

```js
GET /v2/getFeed?filter=
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
filter | string, ... | Список значений которые будут в ответе | 
remove | string, ... | Список значений которые будут удалены из ответа | 
[include](#include) | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
[limit](#limit) | int | Количество объектов в ответе | 5
since | int | Список тайтлов у которых время обновления больше указанного timestamp | 
[description_type](#description_type) | string | Тип получаемого описания, [подробнее](#description_type) | plain
playlist_type | string | Формат получаемого списка серий, `object` или `array` | object
after | int | Удаляет первые n записей из выдачи  | 

*В параметрах `filter` и `remove` можно указать полный путь до ключа который вы хотите оставить или удалить, например `names.alternative` или `team.voice[0]`, с версии 2.8. появилась возможность получать значения одного ключа во всех объектах в массиве, например: torrents.list[\*].torrent_id*

### Примеры запросов
```js
/v2/getFeed?limit=10
```
### Пример ответа

```json
[	
	{
		"youtube": {
			[Возвращаемые поля идентичны /getYouTube]
		}
	},
	{
		"youtube": {
			[Возвращаемые поля идентичны /getYouTube]
		}
	},
	{
	    "title": {
			[Возвращаемые поля идентичны /getTitle]
		}
	},
	...
]
```
***


## • getYears
Возвращает список годов выхода доступных тайтлов отсортированный по возрастанию

```js
GET /v2/getYears
```

### Примеры запросов
```js
/v2/getYears
```
### Пример ответа

```json
[
    1996,
    1998,
    2001,
    2003,
   ...
]
```
***


## • getGenres
Возвращает список жанров доступных тайтлов отсортированный по алфавиту

```js
GET /v2/getGenres
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
sorting_type | int | Тип сортировки элементов | 0
 | | `0 - Сортировка по алфавиту` |
 | | `1 - Сортировка по рейтингу` |

### Примеры запросов
```js
/v2/getGenres
```
### Пример ответа

```json
[
    "боевые искусства",
    "вампиры",
    "демоны",
	...
]
```
***


## • searchTitles
Возвращает список найденных по фильтрам тайтлов

```js
GET /v2/searchTitles
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
search | string, ... | Поиск по именам и описанию |
year | string, ... | Список годов выхода | 
season_code | string, ... | Список сезонов, [подробнее](#season) | 
genres | string, ... | Список жанров | 
voice | string, ... | Список войсеров через запятую | 
translator | string, ... | Список переводчиков | 
editing | string, ... | Список сабберов | 
decor | string, ... | Список оформителей | 
timing | string, ... | Список таймеров | 
filter | string, ... | Список значений которые будут в ответе | 
remove | string, ... | Список значений которые будут удалены из ответа | 
[include](#include) | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
[description_type](#description_type) | string | Тип получаемого описания, [подробнее](#description_type) | plain
playlist_type | string | Формат получаемого списка серий, `object` или `array` | object
[limit](#limit) | int | Количество объектов в ответе | 5
after | int | Удаляет первые n записей из выдачи  | 

### Примеры запросов
```js
/v2/searchTitles?search=cудьба апокреф&voice=Amikiri,Silv,Hekomi&filter=id,names,team,genres[0]&limit=10
```
> Поиск идет по неточному совпадению, так что опечатки допустимы.

### Пример ответа

```json
{
    [Возвращаемые поля идентичны /getTitle]
}
```
***

## • advancedSearch
Возвращает список найденных по фильтрам тайтлов

```js
GET /v2/advancedSearch
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
[query](#query) | string | **Обязательный параметр** Фильтр по которому будет идти выборка, [подробнее](#query) |
filter | string, ... | Список значений которые будут в ответе | 
remove | string, ... | Список значений которые будут удалены из ответа | 
[include](#include) | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
[description_type](#description_type) | string | Тип получаемого описания, [подробнее](#description_type) | plain
playlist_type | string | Формат получаемого списка серий, `object` или `array` | object
[limit](#limit) | int | Количество объектов в ответе, [подробнее](#limit) | 5
after | int | Удаляет первые n записей из выдачи  | 
order_by | string | Ключ по которому будет происходить сортировка результатов |
sort_direction | int | Направление сортировки. 0 - По возрастанию, 1 - По убыванию | 0

### Примеры запросов
```js
/v2/advancedSearch?query={season.code} == 1 and {season.year} == 2020&filter=id,names,in_favorites&order_by=in_favorites&sort_direction=0
```

### Пример ответа

```json
{
    [Возвращаемые поля идентичны /getTitle]
}
```
***


## • getTeam
Возвращает список участников команды когда-либо существовавших на проекте.

```js
GET /v2/getTeam
```

### Примеры запросов
```js
/v2/getTeam
```

### Пример ответа

```json
{
    "team": {
        "voice": [...],
        "translator": [...],
        "editing": [...],
        "decor": [...],
        "timing": [...]
    }
}
```


## • getSeedStats
Возвращает топ пользователей по количеству загруженного и скачанно черехз наш торрент трекер.

```js
GET /v2/getSeedStats
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
users | string, ... | Статистика по имени пользователя |
filter | string, ... | Список значений которые будут в ответе | 
remove | string, ... | Список значений которые будут удалены из ответа | 
[limit](#limit) | int | Количество объектов в ответе | 5
after | int | Удаляет первые n записей из выдачи  | 
sort_by | string | По какому полю производить сортировку, допустимые значения: downloaded, uploaded, user  | 
order | int | Направление сортировки 0 - DESC, 1 - ASC  | 

### Примеры запросов
```js
/v2/getSeedStats?users=T1MOX4
```

### Пример ответа

```json
[
    {
        "downloaded": 72110162198,
        "uploaded": 1163165762554,
        "user": "T1MOX4"
    }
]
```



## • getRSS
Возвращает список обновлений на сайте в одном из форматов RSS ленты

```js
GET /v2/getRSS
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
[rss_type](#rss_type) | string | Предпочитаемый формат вывода | rss
[session](#session) | string | Уникальный идентификатор сессии пользователя
[limit](#limit) | int | Количество объектов в ответе | 10
since | int | Список тайтлов у которых время обновления больше указанного timestamp | 
after | int | Удаляет первые n записей из выдачи  | 

* Если указан верный параметр session то загрузка торрентов будет происходить от имени вашего аккаунта, и вам будет начисляться статистика.
* В случае если ключ указан не верно торрент клинт будет возвращать ошибку о неправильном формате торрента.

### Примеры запросов
```js
/v2/getRSS?rss_type=atom&limit=5
```

### Пример ответа

```xml
<rss version="2.0">
	<channel>
		<title>Самое свежее на AniLibria.TV</title>
		<link>https://anilibria.tv/</link>
		<description>Самое свежие релизы AniLibria.TV</description>
		<lastBuildDate>Wed, 07 Apr 2021 17:59:24 GMT</lastBuildDate>
		<docs>https://validator.w3.org/feed/docs/rss2.html</docs>
		<generator>AniLibria API v2.11.2</generator>
		<language>ru</language>
		<item>
			<title>
			<![CDATA[ Золотое божество 3 / Golden Kamuy 3 | 1-8 [WEBRip 1080p HEVC] ]]>
			</title>
			<link>https://www.anilibria.tv/release/golden-kamuy-3.html</link>
			<guid>12848</guid>
			<pubDate>Tue, 08 Dec 2020 13:50:54 GMT</pubDate>
			<description>
			<![CDATA[ Сугимото отправляется на поиски Асирпы в Карафуто. Также в этом сезоне мы увидим русских солдат, бой с росомахами, путешествующие труппы, харакири, разборки самураев и самое главное — мы узнаем историю и истинные мотивы отца Асирпы. Произойдёт много событий, которые приведут к закрытию некоторых сюжетных арок. ]]>
			</description>
			<enclosure length="2258151277" type="application/x-bittorrent" url="https://static.anilibria.tv/upload/torrents/12848.torrent"/>
		</item>
		...
	</channel>
</rss>
```


## Пользовательские методы для которых нужна авторизация

## • getFavorites
Возвращает список избранных тайтлов пользователя

```js
GET /v2/getFavorites
```

### Все доступные параметры
Параметр | Тип | Описание | Обязательный 
-- | -- | -- | --
[session](#session) | string | Уникальный идентификатор сессии пользователя | +
filter | string, ... | Список значений которые будут в ответе |
remove | string, ... | Список значений которые будут удалены из ответа |
[include](#include) | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
[description_type](#description_type) | string | Тип получаемого описания, [подробнее](#description_type) | plain
playlist_type | string | Формат получаемого списка серий, `object` или `array` | object

*В параметрах `filter` и `remove` можно указать полный путь до ключа который вы хотите оставить или удалить, например `names.alternative` или `team.voice[0]`, с версии 2.8. появилась возможность получать значения одного ключа во всех объектах в массиве, например: torrents.list[\*].torrent_id*

### Примеры запросов
```js
/v2/getFavorites?session=qwertyqwertyqwerty1234567890
```

### Пример ответа

```json
[
	[Возвращаемые поля идентичны /getTitle],
	...
]
```



## • addFavorite
Добавить тайтл в список избранных

```js
PUT /v2/addFavorite
```

### Все доступные параметры
Параметр | Тип | Описание | Обязательный 
-- | -- | -- | --
[session](#session) | string | Уникальный идентификатор сессии пользователя | +
title_id | int | ID тайтла который вы хотите добавить | +


### Примеры запросов
```js
/v2/addFavorite?session=qwertyqwertyqwerty1234567890&title_id=8500
```

### Пример ответа

```json
{
	"success": true
}
```



## • delFavorite
Удалить тайтл из списка избранных

```js
DELETE /v2/delFavorite
```

### Все доступные параметры
Параметр | Тип | Описание | Обязательный 
-- | -- | -- | --
[session](#session) | string | Уникальный идентификатор сессии пользователя | +
title_id | int | ID тайтла который вы хотите удалить | +


### Примеры запросов
```js
/v2/delFavorite?session=qwertyqwertyqwerty1234567890&title_id=8500
```

### Пример ответа

```json
{
	"success": true
}
```




### Возвращаемые значения при запросе информации о тайтле
id **int**  – ID тайтла
code **string** – Код тайтла, используется для создания ссылки
[names](#names): **object** – Названия тайтла.
[posters](#posters) **object** – Информация о постере
updated **int** – Timestamp последнего обновления тайтла (обычно тайтл обновляют при выходе новых релизов)
last_change **int** – Timestamp последнего изменения тайтла (Например описания, или анонса)
[status](#status) **object** – Статус тайтла
[type](#type) **object** – Типа тайтла
genres **array[string]** – Список жанров
[team](#team) **object** – Ники членов команды работавших над тайтлом
[season](#season) **object** – Сезон, год выхода, и день недели из расписания когда выходят новые серии
year **int** – Год выпуска тайтла
week_day **int** – День недели, когда выходят новые релизы
description **string** – Описание тайтла в указанном в [description_type](#description_type) формате
[blocked](#blocked) **object** – Информация о блокировках тайтла
[player](#player) **object** – Информация о сериях в плеере
[torrents](#torrents) **object** – Информация о торрент файлах

### Возвращаемые значения при запросе информации о youtube ролике
id **int**  – ID записи в базе
title **string** – Название видео ролика
image **string** – Ссылка на превью к ролику
youtube_id **string** – ID видео на YouTube (Легко форматируется в https://youtu.be/{youtube_id})
timestamp **int** – Timestamp времени добавления в базу


>*В случае отсутствия какой-то информации значения поля будет `null` для строк, пустой массив для массивов, и 0 для чисел*
>*Такое редко, но бывает.*



#### names:
> ru **string** – Русское название тайтла
> en **string** – Английское название тайтла
> alternative **string** – Альтернативное название

#### posters:
> [small](#poster) **object** – Постер маленького размера
> [medium](#poster) **object** – Постер среднего размера
> [original](#poster) **object** – Оригинальный и самый большой постер

#### series:
> string **string** – Количество серий в виде строки
> first **int** – Первая серия
> last **int** – Последняя серия

#### status:
> string **string** – Статус тайтла в виде строки
> code **int** – Статус тайтла в виде числа
>> 1 – В работе
>> 2 – Завершен
>> 3 – Скрыт
>> 4 – Неонгоинг

#### type:
> full_string **string** – Тип тайтла целиком в виде строки (как это указано на сайте)
> string **string** – Тип тайтла в виде строки
> series **int** – Ожидаемое количество серий
> length **string** – Длительность серий
> code **int** – Тип тайтла в виде числа 
>> 0 – Фильм
>> 1 – TV
>> 2 – OVA
>> 3 – ONA
>> 4 – Спешл

#### team:
> voice **array[string]** – Список войсеров работавших над озвучкой
> translator **array[string]** – Список участников команды работавших над переводом
> editing **array[string]** – Список участников команды работавших над субтитрами
> decor **array[string]** – Список участников команды работавших над оформлением
> timing **array[string]** – Список участников команды работавших над таймингом

#### season:
> year **int** – Список войсеров работавших над озвучкой
> week_day **int** – Список участников команды работавших над оформлением
> > Счет дней недели идет с понедельника, где 0 - Понедельник, а 6 - Воскресенье.
> string **string** – Название сезона в котором вышел тайтл.
> code **int** – Код сезона в котором вышел тайтл.
> > Возможные значения:
> > 1 - Зима, 2 - Весна, 3 - Лето, 4 - Осень

#### blocked:
> blocked **bool** – Тайтл заблокирован на территории РФ
> bakanim **bool** – Тайтл заблокирован из за жалобы Wakanim
***

#### player:
> alternative_player **string** – Ссылка на альтернативный плеер
> [host](#host) **object** – Имена предпочитаемых серверов для построения ссылок на поток и скачивание
> [playlist](#playlist) **object** – Список релизов тайтла со ссылками на просмотр и загрузку.
> [series](#series) **object** – Количество вышедших в плеере серий


##### poster:
> url **string** – Относительный url на постер
> raw_base64_file **string** – Постер в base64 формате (если запрошен в параметре [include](#include))

##### host:
> hls **string** – Ссылка без домена на альтернативный плеер
Эти имена служат для того чтоб использовать их как часть ссылки к файлу.
Например `http://de3.libria.fun/videos/ts/8500/0001/playlist.m3u8` позволит скачать указанный файл с сервера.

##### playlist:
> serie **int** – Номер серии
> created_timestamp **int** – Время создания/изменения плейлиста в формате unix timestamp
> [hls](#hls) **object** – Объект содержащий ссылки на потоковое воспроизведение в разном качестве

###### hls:
> fhd **string** – Ссылка без домена на потоковое воспроизведение в Full-HD качестве
> hd **string** – Ссылка без домена на потоковое воспроизведение в HD качестве
> sd **string** – Ссылка без домена на потоковое воспроизведение в SD качестве
***

#### torrents:
> [series](#series) **object** – Серии содержащиеся в файле
> list **array[object]** – Массив объектов с информацией о торрент файлах

##### list:
*Содержит массив объектов с информацией о торрент файлах.*
> torrent_id **int** – ID торрент файла
> [series](#series) **object** – Серии содержащиеся в файле
> [quality](#quality) **object** – Информации о разрешении, кодировщике и типе релиза
> leechers **int** – Количество личеров (личей)
> seeders **int** – Количество сидеров (сидов)
> downloads **int** – Количество загрузок файла
> total_size **int** – Размер файлов в торренте в байтах
> url **string** – Ссылка на торрент файл без домена
> uploaded_timestamp **int** – Время загрузки торрента в формате unix timestamp
> raw_base64_file **string** – Торрент файл в base64 формате (если запрошен в параметре [include](#include))
> [metadata](#metadata) **object** – Объект содержащий метаданные торрент файла

###### quality:
> string **string** – Полная строка с описание качества и типа релиза
> type **string** – Тип релиза WEBRip, HDRip и  тд...
> resolution **int** – Разрешение одной стороны изображения. Например 720
> encoder **string** – Строка указывающая на кодировщик используемый для кодирования релиза, h264 или h265
> lq_audio **bool** – Используется ли аудио дорожка с пониженным битрейтом (Для экономии размера файла)

###### metadata:
> hash **string** – Хеш торрент файла
> name **string** – Имя тайтла в торрент файле
> announce **array[string]** – Массив строк содержащий список трекеров
> created_timestamp **int** – Время создания торрента в формате unix timestamp
> [files_list](#files_list) **array[object]** – Массив объектов содержащий список файлов в торренте

###### files_list:
> file **string** – Имя файла
> size **int** – Размер файла в байтах
> offset **int64** – Смещение в байтах относительно предыдущего файла


#### description_type:
> html – Описание тайтла в виде html (в том виде в каком оно на сайте)
> plain – Описание тайтла в виде текста без дополнительного форматирования
> no_view_order – Описание тайтла в виде текста без дополнительного форматирования и порядка просмотра

#### include:
*Это полезно в случае если вы не хотите делать много запросов, такая конструкция позволяет получить все необходимое в одном запросе*
> raw_poster – Добавить постер в base64 формате в ответ
> raw_torrent – Добавить торрент файлы в base64 формате в ответ
> torrent_meta - Добавить в ответ метаданные торрента (список файлов, их размер, трекер)

#### limit:
*Количество объектов в ответе
Любое положительное число, или -1, чтоб получить все результаты.

#### rss_type:
Предпочитаемый формат вывода RSS ленты
* Название | Описание
-- | --
rss | RSS 2.0 (По умолчанию)
atom | Atom 1.0
json | JSON Feed 1.0

#### query:
*Ключи объектов должны быть закрыты в фигурные скобки, например {names.ru}

* Сравнение | Описание
-- | --
`x == y` | Равно
`x != y` | Не равно
`x < y` | Меньше чем
`x <= y` | Меньше чем или равно
`x > y` | Больше чем
`x >= y` | Больше чем или равно
`x ~= y` | Регулярное выражение
`x in (a, b, c)` | Эквивалент (x == a or x == b or x == c)
`x not in (a, b, c)` | Эквивалент (x != a and x != b and x != c)

* Логические | Описание
-- | --
`x and y` | Логическое И
`x or y` | Логическое ИЛИ
`not x` | Логическое НЕ
`x ? y : z` | Условие x, истина y, ложь z
`( x )` | Оператор приоритета, например `(x == y or y < 10) and z)`

* Математические | Описание
-- | --
`x + y` | Сложение
`x - y` | Вычитание
`x * y` | Умножение
`x / y` | Деление
`x % y` | Модуль
`x ^ y` | Степень

* Объекты и массивы | Описание
-- | --
`(a, b, c)` | Массив
`a in b` | Массив a является подмножеством массива b
`x of y` | Свойство x объекта y

* Встроенные функции | Описание
-- | --
`abs(x)` | Абсолютное значение
`ceil(x)` | Округление float числа вверх
`floor(x)` | Округление float числа вниз
`log(x)` | Натуральный логарифм
`max(a, b, c...)` | Максимальное число из указанных  (число аргументов может быть любым)
`min(a, b, c...)` | Минимальное число из указанных (число аргументов может быть любым)
`random()` | Случайное float значение от 0.0 до 1.0
`round(x)` | Простое округление float
`sqrt(x)` | Квадратный корень
`len(x)` | Длина массива или строки
`randomInt(min, max)` | Случайное число в указанном диапазоне

#### session:

Для получения ключа, нужно отправить POST запрос на адрес
`https://www.anilibria.tv/public/login.php`

Параметр | Тип | Описание | Обязательный 
-- | -- | -- | --
mail | string | Логин или электронная почта от аккаунта | +
passwd | string | Пароль от аккаунта | +

После успешной авторизации в ответе должна быть кука PHPSESSID, которая нам и нужна.

Стоит помнить:
* Авторизация может пропасть в любой момент, т.к. время жизни сессии ограничено
* Подходят только новые сессии которые были начаты после 14.04.2021, при использовании старый сессий будет ошибка.

***



### Возможные коды ошибок
```json
{
	"error": { "code": 500, "message": "Internal Server Error!" }
}
```
Возникает в случае непредвиденной внутренней ошибки сервера.
> Все 5хх ошибки возвращают статус код 500, хотя в теле ответа будет указан настоящий код.
```json
{
	"error": { "code": 412, "message": "Unknown parameters: code, id" }
}
```
Возникает в случае если передать неизвестный параметр в запросе.
```json
{
	"error": { "code": 404, "message": "Title "test" not found!" }
}
```
Возникает в случае если запрошен тайтл которого нет в базе

и другие...

>В случае ошибки HTTP Status дублирует код из **error.code** (Исключение 5хх ошибки)
>В случае успешного выполнения запроса будет возвращен HTTP Status:  **200**
***

### Полезное
1. Версию API можно узнать в заголовке `API-Version` и сравнить ее с версией документации, чтоб узнать актуальна ли документация.
2. Версии меняются по принципу <Major>.<Minor>.<Patch> где Major обозначает очень крупные изменения в коде проекта без обратной совместимости, Minor обозначает существенные изменения в API с частичной обратной совместимостью, и Patch исправление различных ошибок, не влияет на совместимость.
3. С версии 2.6.2. появилась поддержка старых версий api и был расширен функционал версионирования.
Таким образом теперь можно использовать либо последнюю версию с последними исправлениями, либо старую минорную со старой схемой которая не будет обновляться и меняться со временем.
Например, сейчас можно использовать ссылки следующего формата:
>Ссылка на актуальную мажорную версию API - https://api.anilibria.tv/v2/...
>Ссылка на минорный патч со всеми исправлениями - https://api.anilibria.tv/v2.6/...
>Ссылка на патч - https://api.anilibria.tv/v2.6.2/...
4. Полезно использовать фильтры при запросе информации о множестве тайтлов, к примеру исключив информацию о преере вы существенно сэкономите время ответа если она вам не нужна.


## WebSocket
```js
ws(s)://api.anilibria.tv/v2/ws/
```
или
```js
ws(s)://api.anilibria.tv/v2/webSocket/
```

### Подписка на тайтлы
Для подписки нужно отправить по веб сокету команду в json формате со следующим содержанием:
```json
{
	"subscribe": {
		"season": {
			"year": 2020
		}
		//Тут могут быть любые поля и значения которые отправляет вебсокет. После добавления подписки вебсокет будет отправлять только те обновления которые соответствуют заданым фильтрам. Можно отправить несколько фильтров, тогда API будет отправлять уведомление при совпадении с одним из них.
	}
}
```
По умолчанию при подключении клиента подписывает на все уведомления сразу, но после добавления первой подписки будут приходить исключительно те уведомления на которые вы подписались.
В качестве значения также можно указать `*` что будет соответствовать любому значению указанного поля.
Таким образом к примеру можно подписаться на получение уведомлений только о выходе всех серий начиная с 12
```json
{
	"subscribe": {
		"player": {
			"playlist": {
				"12": *
			}
		}
	}
}
```
#### Фильтры
При добавлении подписки можно указать какие поля API будет вам отправлять
Работает это также, как и при указании фильтров к GET запросам.
Например
```json
{
	"subscribe": {
		"season": {
			"year": 2020
		}
	},
	"filter": "names,season",
	"remove": "names.en"
}
```
### Уведомления

#### title_update
При обновлении какой-либо информации о тайтле Веб Сокет отправляет всем клиентам строку в JSON формате:
```json
{
	"title_update": {
		"hash": "c3499c2729730a7f807efb8676a92dcb6f8a3f8f"
    	"title": {
			[Возвращаемые поля идентичны /getTitle]
		},
		"diff": {
			[Те ключи и значения что были изменены, добавлены, или удалены]
		}
	}
}
```

##### Возвращаемые значения
hash **string**  – Хеш уведомления для проверки уникальности уведомления
title **object** – Объект содержащий все поля из /getTitle
diff  **object** – Объект содержащий информацию о том какие данные были изменены.

#### playlist_update
При обновлении плейлиста тайтла, что происходит при добавлении или перезаливе релиза, ВебСокет отправляет всем клиентам строку в формате:
```json
{
	"id": 8500,
	"serie": 1,
	"quality": "hd",
    "player": {
		"alternative_player": "//kodik.info/serial/19248/803944eb832adacd4d4bec7d4221f941/720p?translations=false",
        "host": de4.libria.fun",
        "series": {
            "first": 1,
            "last": 24,
            "string": "1-24"
        },
		"playlist": {
			"1": {
				"serie": 1,
				"hls": {
					"fhd": "/videos/ts/8500/0001-hd/playlist.m3u8",
					"hd": "/videos/ts/8500/0001/playlist.m3u8",
					"sd": "/videos/ts/8500/0001-sd/playlist.m3u8"
				}
			}
		}
        ...
    }
}
```

##### Возвращаемые значения
id **int**  – ID обновленного тайтла
serie **int**  – Номер вышедшего или перезалитого релиза
[player](#player) **object** – Объект содержащий все плейлисты
quality **string**  – Качество в котором стала доступна серия (одно из значений [hls](#hls))

#### start_encode
При начале кодирования серии в плеер, что происходит при добавлении или перезаливе релиза, ВебСокет отправляет всем клиентам строку в формате:
```json
{
	"id": 8500,
	"serie": 1,
	"quality": "hd",
}
```

##### Возвращаемые значения
id **int**  – ID обновленного тайтла
serie **int**  – Номер вышедшего или перезалитого релиза
quality **string**  – Качество в котором стала доступна серия (одно из значений [hls](#hls))


#### end_encode
Когда серия успешно скодирована во всех доступныхз качествах, ВебСокет отправляет всем клиентам строку в формате:
```json
{
	"id": 8500,
	"serie": 1
}
```

##### Возвращаемые значения
id **int**  – ID обновленного тайтла
serie **int**  – Номер вышедшего или перезалитого релиза

> Раз в 30 секунд отправляется Ping пакет который проверяет соединение.
***
